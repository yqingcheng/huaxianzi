<style lang="scss">
    @font-face {
        font-family: "iconfont";
        src: url(data:application/x-font-woff;charset=utf-8;base64,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) format('woff');
    }

    .iconfont {
        font-family:"iconfont" !important;
        font-size:16px;
        font-style:normal;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .icon-shanchu:before { content: "\e7c8"; }

    .icon-zhankai:before { content: "\e809"; }

    .icon-geren:before { content: "\e7a3"; }

    .icon-pinglun:before { content: "\e607"; }

    .icon-zhaopianphoto177:before { content: "\e611"; }

    .icon-5:before { content: "\e63c"; }

    .icon-exchangejiaohuan:before { content: "\e6da"; }

    .icon-emizhongzi:before { content: "\e64a"; }

    .icon-fenxiang:before { content: "\e68e"; }

    .icon-icon_edit:before { content: "\e610"; }

    .icon-zhankai1:before { content: "\e608"; }

    .icon-sousuo:before { content: "\e658"; }

    .icon-gouwuche:before { content: "\e620"; }

    .icon-pinglun1:before { content: "\e603"; }

    .icon-dianzan:before { content: "\e69c"; }

    .icon-chenggong:before { content: "\e605"; }

    .icon-dizhi:before { content: "\e70f"; }

    .icon-jia:before { content: "\e715"; }

    page{
        height: 100%;
    }
    .me{
        width: 100%;
        height: 100%;
        background: #7cbfb6;
        overflow: hidden;
        &_img{
            width: 200rpx;
            height: 200rpx;
            border-radius: 200rpx;
            margin: 100rpx auto 0 auto;
            z-index: 999;
            position: relative;
            display: block;
            background: rgba(0,0,0,.5);
        }
        .user_name{
            text-align: center;
            top:240rpx;
            font-size: 21rpx;
            line-height: 55rpx;
            color: white;
            position: absolute;
            z-index: 999;
            width: 100%;
        }
        .getname{
            text-align: center;
            top:200rpx;
            font-size: 30rpx;
            background: rgba(0,0,0,0);
            position: absolute;
            z-index: 999;
            width: 100%;
            border: none;
        }
        &_content{
            width: 100%;
            height: 100%;
            margin-top: -100rpx;
            overflow: hidden;
            &_circle{
                width: 180%;
                background: #fefefe;
                height: 100%;
                border-radius: 50%;
                transform: translateX(-22.5%);
                overflow: hidden;

            }
        }
        .tabview{
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 128rpx;
            z-index: 999;
            position: absolute;
            top: 340rpx;
            left: 0;
            .tab{
                height: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                font-size: 30rpx;
                color: #7cbfb6;
                box-sizing: border-box;
                view{
                    margin-top: 10rpx;
                }
            }
            .we{
                border-bottom: 2px solid #17cb30;
            }
        }
        .record{
            margin-bottom: 50rpx;
            .block{
                width: 100%;
                border-bottom: 1px dashed #ccc;
            }
            width: 100%;
            box-sizing: border-box;
            padding: 10rpx 20rpx 0 20rpx;
            position: absolute;
            left: 0;
            top: 470rpx;
            display: flex;
            flex-flow: row wrap;
            font-size: 28rpx;
            color: #333;
            .title{
                font-size: 30rpx;
                color: #333;
                margin-top: 40rpx;
            }
            .detal{
                font-size: 28rpx;
                color: #888;
                line-height: 75rpx;
            }
            .urls{
                display: flex;
                flex-flow: row wrap;
                margin-right: -10rpx;
                margin-top: -10rpx;
                image{
                    width: 48.5%;
                    height: 295rpx;
                    margin-right: 10rpx;
                    margin-top: 10rpx;
                }
                .yi{
                    width: 100%;
                    height: 400rpx;
                    margin-right: 10rpx;
                    background: no-repeat;
                    background-position: center;
                    background-size: cover;
                }
                .er{
                    width: 48.5%;
                    height: 300rpx;
                    margin-right: 10rpx;
                    margin-top: 10rpx;
                    background: no-repeat;
                    background-position: center;
                    background-size: cover;
                }
                .san{
                    width: 31.9%;
                    height: 200rpx;
                    margin-right: 10rpx;
                    margin-top: 10rpx;
                    background: no-repeat;
                    background-position: center;
                    background-size: cover ;
                }
            }
            .funct{
                .yesok{
                    font-size:38rpx;
                    color:#7cbfb6
                }
                .nono{
                    font-size:38rpx;
                    color:red
                }
                width: 100%;
                display: flex;
                font-size: 28rpx;
                color: #888;
                line-height: 38rpx;
                margin: 15rpx 0;
                padding-bottom: 10rpx;
                position: relative;
                view:nth-child(1){
                    margin-right: 47rpx;
                }
                view:nth-child(2){
                    position: absolute;
                    right: 0;
                }
            }
            .comment{
                background: rgba(0,0,0,.1);
                margin-bottom: 20rpx;
                view{
                    font-size: 27rpx;
                    color: #333;
                    line-height: 52rpx;
                }
            }

                .say{
                    width: 100%;
                    height: 300rpx;
                    border-radius: 5rpx;
                    border: 1px solid #eee;
                    font-size: 30rpx;
                    color: #333;
                    padding: 10rpx 20rpx;
                    margin-top: 20rpx;
                    box-sizing: border-box;
                    z-index: 9;
                    background: white;
                }
            .says{
                width: 100%;
                height: 300rpx;
                border-radius: 5rpx;
                border: 1px solid #eee;
                font-size: 30rpx;
                color: #333;
                padding: 10rpx 20rpx;
                box-sizing: border-box;
                z-index: 9;
                background: white;
            }

        }
        .tablist{
            width: 100%;
            box-sizing: border-box;
            padding: 10rpx 20rpx 0 20rpx;
            position: absolute;
            left: 0;
            top: 470rpx;
            display: flex;
            flex-flow: row wrap;
        }
        .myrecord{
            width: 100%;
            box-sizing: border-box;
            position: absolute;
            left: 0;
            top: 470rpx;
        }
        .shopcar{
            position: fixed;
            right: 0;
            top:820rpx;
            width: 80rpx;
            height: 80rpx;
            border-radius: 50%;
            border: 1px solid #ccc;
            text-align: center;
            line-height: 80rpx;
        }
    }
</style>

<template>
    <view class="me">
        <image class="me_img" src="{{userInfo.avatarUrl}}" @tap="nickName"></image>
        <view class="user_name" wx:if="{{userInfo.nickName}}" @tap="nickName" >
            {{userInfo.nickName}}
        </view>
        <button wx:if="{{!userInfo.nickName}}" class="getname" open-type="getUserInfo" lang="zh_CN" bindgetuserinfo="onGotUserInfo">登录</button>
        <view class="me_content">
            <view class="me_content_circle">

            </view>
        </view>

        <view class="tabview">
            <repeat for="{{tabview}}" key="{{index}}">
                <view class="tab {{num == index ? 'we' : '' }}" data-index="{{index}}" @tap="tabvie" >
                    <icon1 :type="item.icon" color="#7cbfb6" fontSize="60"></icon1>
                    <view>{{item.name}}</view>
                </view>
            </repeat>
        </view>
        <view class="record" wx:if="{{num == 0}}">

            <repeat for="{{history}}"  key="{{index}}">
                <view class="block">
                    <!--<view class="title">{{item.nickname || '乔东'}}</view>-->
                    <view class="detal">{{item.content}}</view>
                    <view class="urls">
                        <view class="{{item.image.length == 1 ? 'yi' : item.image.length == 2 ? 'er' : 'san'}}"
                              wx:for="{{item.image}}"
                              @tap="imgFix"
                              data-srcurl="{{item.image}}"
                              data-img="{{ind.image}}"
                              wx:for-item="ind"
                              wx:key="{{index}}"
                              style="background-image: url('{{ind.image}}')"
                        ></view>

                    </view>
                    <view class="funct">
                        <view @tap="comment" data-index="{{index}}">
                            <icon9 type="pinglun" color="#7cbfb6" zan="{{item.zan_status}}" fontSize="38"></icon9>
                            评论
                        </view>
                        <view @tap="deljilu" data-id="{{item.id}}">
                            <icon6 type="shanchu" color="#999" fontSize="30"></icon6>
                            删除
                        </view>
                        <view @tap="fabulous" data-id="{{item.id}}">
                            <text class="iconfont icon-dianzan {{item.zan_status == 0 ? 'yesok' : 'nono'}}"></text>
                            {{item.zan}}
                        </view>
                    </view>
                    <view class="comment">
                        <view wx:for="{{item.comments}}"
                              wx:for-item="com"
                              wx:key="{{index}}">
                            <view @tap="huifu" data-id="{{com.id}}" data-index="{{index}}">
                                {{com.nickname}}：{{com.content}}
                            </view>
                            <view wx:for="{{com.reply}}" wx:for-item="ids" wx:key="{{index}}">
                                {{}}回复{{}}:{{ids.content}}
                            </view>
                            <textarea class="says"
                                      data-openid="{{com.openid}}"
                                      wx:if="{{statushuifu[com.id]}}"
                                      data-id="{{com.id}}"
                                      cursor-spacing="100px"
                                      @input="huifuhander"
                                      bindconfirm="inputOkse"
                                      placeholder="回复评论" />
                        </view>
                    </view>

                        <textarea class="say"
                                  wx:if="{{statusArr[index]}}"
                                  data-id="{{item.id}}"
                                  cursor-spacing="100px"
                                  @input="bindTextAreaBlur"
                                  bindconfirm="inputOks"
                                  placeholder="说点什么......" />

                    <!--<input class="say" type="text" placeholder="说点什么......" />-->
                </view>
            </repeat>

            <!--<repeat for="{{history}}" key="{{index}}">-->
                <!--<view class="issd"  data-id="{{item.id}}">-->
                    <!--<image src="{{item.image[0].image}}"></image>-->
                    <!--<view class="detailse">-->
                        <!--<view><text>我的动态记录：</text>{{item.content}}</view>-->
                        <!--<view class="decc">-->
                            <!--<icon2 type="pinglun" color="#999" fontSize="30"></icon2>-->
                            <!--<view catchtap="deljilu" data-id="{{item.id}}">-->
                                <!--<icon4 type="shanchu" color="#999" fontSize="30"></icon4>-->
                                <!--<text>删除</text>-->
                            <!--</view>-->

                        <!--</view>-->

                    <!--</view>-->
                <!--</view>-->

            <!--</repeat>-->

        </view>
        <view class="tablist" wx:if="{{num == 1}}">
            <seed :myzhongzi.sync="myzhongzi"
                  @mySeed.user="mySeed"></seed>
        </view>
        <view class="myrecord" wx:if="{{num == 2}}">
            <returnz :returnRecord.sync="myrecord" @del.user="del" @modify.user="modify" @goodsDetails.user="goodsDetails"></returnz>
        </view>
        <view class="shopcar" @tap="shopCar">
            <icon3 type="gouwuche" color="#888" fontSize="55"></icon3>
        </view>

    </view>
</template>

<script>
    import wepy from 'wepy'
    import Icon from '../components/Icon'
    import Returnz from '../components/Returnz'
    import Seed from '../components/Seed'
    import getExtJson from '../mixins/getExtJson'


    export default class Me extends wepy.page{
        config = {
            navigationBarTitleText: '个人中心'
        }
        data = {
            myzhongzi: [],
            userInfo: {},
            tabview: [
                {
                    name: '我的记录',
                    icon: '5'
                },
                {
                    name: '我的种子',
                    icon: 'emizhongzi'
                },
                {
                    name: '我的交换',
                    icon: 'exchangejiaohuan'
                },
            ],
            history: [],
            myrecord: [],
            statusArr: [],
            num: 0,
            statushuifu: []
        }
        components = {
            icon1: Icon,
            icon2: Icon,
            returnz: Returnz,
            icon3: Icon,
            icon4: Icon,
            icon9: Icon,
            icon6: Icon,
            seed: Seed
        }
        myreturn() {
            wepy.request({
                url: `${this.api_host}/restapi/exchange/lists`,
                data: {
                    openid: wx.getStorageSync('openid')
                },
                success: (res) => {
                    this.myrecord = res.data.data
                    this.$apply()
                }
            })
        }
        myjilu() {
            wepy.request({
                url: `${this.api_host}/restapi/topical/lists`,
                data: {
                    openid: wx.getStorageSync('openid')
                },
                success: (res) => {
                    this.history = res.data.data
                    this.$apply()
                }
            })
        }
        methods = {
            huifu(e) {

                let index = e.currentTarget.dataset.id
                this.statusArr = []
                if(this.statushuifu[index]) {
                    this.statushuifu[index] = false
                } else {
                    this.statushuifu = []
                    this.statushuifu[index] = true
                }
            },
            imgFix(e) {
                let srcurl = []
                e.currentTarget.dataset.srcurl.forEach( item => {
                    srcurl.push(item.image)
                })
                wx.previewImage({
                    current: e.currentTarget.dataset.img, // 当前显示图片的http链接
                    urls: srcurl // 需要预览的图片http链接列表
                })
                this.$apply()
            },
            /*
            * 评论
            * */
            comment(e) {
                this.statushuifu = []
                let index = e.currentTarget.dataset.index
                if(this.statusArr[index]) {
                    this.statusArr[index] = false
                } else {
                    this.statusArr = []
                    this.statusArr[index] = true
                }

                this.$apply()
            },
            bindTextAreaBlur(e) {
//                console.log(e.detail.value)
            },
            /*
            * 回复评论
            * */
            inputOkse(e) {
                if(this.$parent.globalData.userInfo) {
                    console.log('comment_id:', e.currentTarget.dataset.id,
                        'from_openid:', wx.getStorageSync('openid'),
                        'to_openid:', e.currentTarget.dataset.openid,
                        'content:', e.detail.value,
                        'nickname:', this.userInfo.nickName)
                    wepy.request({
                        url: `${this.api_host}/restapi/reply/create`,
                        data: {
                            comment_id: e.currentTarget.dataset.id,
                            from_openid: wx.getStorageSync('openid'),
                            to_openid: e.currentTarget.dataset.openid,
                            content: e.detail.value,
                            nickname: this.userInfo.nickName
                        },
                        method: 'post',
                        success: (res) => {
                            this.$apply()
                        }
                    })
                } else {
                    wx.showToast({
                        title: '您还没有登录',
                        image: '../images/fails.png',
                        duration: 2000
                    })
                }
            },
            /*
            * 发布评论
            * */
            inputOks(e) {
                if(this.$parent.globalData.userInfo) {
                    wepy.request({
                        url: `${this.api_host}/restapi/comment/create`,
                        data: {
                            topical_id: e.currentTarget.dataset.id,
                            openid: wx.getStorageSync('openid'),
                            content: e.detail.value
                        },
                        method: 'post',
                        success: (res) => {
                            this.statusArr = []
                            console.log(res, e)
//                            this.history.comments.push(res.data.data)
                            this.history.forEach( item => {
                                if(item.id == e.currentTarget.dataset.id) {
                                    item.comments.push(res.data.data)
                                }
                            })
                            this.$apply()
                        }
                    })
                } else {
                    wx.showToast({
                        title: '您还没有登录',
                        image: '../images/fails.png',
                        duration: 2000
                    })
                }
            },
            /*
            * 赞
            * */
            fabulous(e) {
                if(this.$parent.globalData.userInfo) {
                    this.history.forEach( item => {
                        if(item.id === e.currentTarget.dataset.id) {
                            if(item.zan_status === 0) {
                                item.zan_status = 1
                                item.zan ++
                                wepy.request({
                                    url: `${this.api_host}/restapi/zan/create`,
                                    data: {
                                        id: e.currentTarget.dataset.id,
                                        openid: wx.getStorageSync('openid'),
                                    },
                                    method: 'post',
                                    success: (res) => {
                                        console.log(res)
                                        this.$apply()
                                    }
                                })
                            } else {
                                wx.showToast({
                                    title: '您已点过赞',
                                    image: '../images/fails.png',
                                    duration: 2000
                                })
                            }

                        }
                    })
                } else {
                    wx.showToast({
                        title: '您还没有登录',
                        image: '../images/fails.png',
                        duration: 2000
                    })
                }
            },
            /*
            * 删除记录
            * */
            deljilu(e) {
                wx.showModal({
                    title: '提示',
                    content: '确定删除此条动态？',
                    success: (res) => {
                        if (res.confirm) {
                            if(this.$parent.globalData.userInfo) {
                                wepy.request({
                                    url: `${this.api_host}/restapi/topical/delete?id=${e.currentTarget.dataset.id}`,
                                    method: 'delete',
                                    success: (res) => {
                                        this.history.forEach( (item, index) => {
                                            console.log(12121)
                                            if(item.id == e.currentTarget.dataset.id) {
                                                this.history.splice(index, 1)
                                                this.$apply()
                                            }
                                        })
                                        wx.showToast({
                                            title: '删除成功',
                                            icon: "success",
                                            duration: 2000
                                        })

                                        this.$apply()
                                    }
                                })
                            } else {
                                wx.showToast({
                                    title: '您还没有登录',
                                    image: '../images/fails.png',
                                    duration: 2000
                                })
                            }
                        } else if (res.cancel) {
                            console.log('用户点击取消')
                        }
                    }
                })
            },
            /*
            * 登录
            * */
            onGotUserInfo() {
                wepy.getUserInfo({
                    success: (res) => {
                        this.$parent.globalData.userInfo = res.userInfo
                        this.userInfo.nickName = res.userInfo.nickName
                        this.userInfo.avatarUrl = res.userInfo.avatarUrl
                        wx.showToast({
                            title: '登陆成功',
                            icon: "success",
                            duration: 2000
                        })
                        this.myjilu()
                        wepy.request({
                            url: `${this.api_host}/restapi/userinfo/create`,
                            method: 'post',
                            data: {
                                openid: wx.getStorageSync('openid'),
                                nickname: this.userInfo.nickName,
                                touxiang: this.userInfo.avatarUrl
                            },
                            success: (res) => {}
                        })
                        this.$apply()
                    }
                })
            },
            /*
            * 切换状态
            * */
            tabvie(e) {
                this.num = e.currentTarget.dataset.index
                if(this.num == 0) {
                    this.myjilu()
                }
                if(this.num == 1) {
                    this.userseeds()
                }
                if(this.num == 2) {
                    this.myreturn()
                }
                this.$apply()
            },
            /*
            * 删除
            * */
            del(e) {
                wx.showModal({
                    title: '提示',
                    content: '确定删除此条交还记录？',
                    success: (res) => {
                        if(res.confirm) {
                            if(this.$parent.globalData.userInfo) {
                                wepy.request({
                                    url: `${this.api_host}/restapi/exchange/delete?id=${e.currentTarget.dataset.id}`,
                                    method: 'delete',
                                    success: (res) => {
                                        this.myrecord.forEach( (item, index) => {
                                            if(item.id == e.currentTarget.dataset.id) {
                                                this.myrecord.splice(index, 1)
                                                this.$apply()
                                            }
                                        })
                                        wx.showToast({
                                            title: '已删除',
                                            icon: "success",
                                            duration: 2000
                                        })


                                    }
                                })
                            } else {
                                wx.showToast({
                                    title: '您还没有登录',
                                    image: '../images/fails.png',
                                    duration: 2000
                                })
                            }
                        } else if (res.cancel) {
                            console.log('用户点击取消')
                        }
                    }
                })

            },
            /*
            * 修改
            * */
            modify(e) {
                wx.navigateTo({url: `add?name=修改&id=${e.currentTarget.dataset.id}`})
            },
            /*
            * 商品详情
            * */
            goodsDetails(e) {
                let name = e.currentTarget.dataset.name
                let status = e.currentTarget.dataset.status
                let id = e.currentTarget.dataset.id
                wx.navigateTo({url: `add?name=${name}&status=${status}&id=${id}`})
            },
            /*
            * 我的记录
            * */
//            myRecord(e) {
//                this.$parent.globalData.num = 0
//                this.$apply()
////                wx.navigateTo({url: `jiludetail?id=${e.currentTarget.dataset.id}`})
//                /*
//                * 传当前这条记录的id
//                * */
//            },
            /*
            * 我的种子
            * */
            mySeed(e) {
                let status = e.currentTarget.dataset.status
                let name = e.currentTarget.dataset.name

                if(status === '待归还') {
                    wx.navigateTo({url: `returnseed?gx_id=${e.currentTarget.dataset.gx_id}`})
                } else {
                    wx.navigateTo({url: `seeddetails?name=${name}&status=1&id=${e.currentTarget.dataset.id}`})
                }
            },
            /*
            * 修改个人信息
            * */
            nickName() {
                wx.navigateTo({url: `information`})
            },
            shopCar() {
                wx.navigateTo({url: `shopCar`})
            }
        }
        userseeds() {
            if(this.$parent.globalData.userInfo) {
                wepy.request({
                    url: `${this.api_host}/restapi/user-seed`,
                    data: {
                        openid: wx.getStorageSync('openid')
                    },
                    success: (res) => {
                        res.data.data.items.forEach( item => {
                            item.shop_name = item.order_name
                            item.shop_kind = item.plantname
                            item.image = `${this.img_host}${item.image}`
                        })
                        this.myzhongzi = res.data.data.items

                        this.$apply()
                    }
                })
            } else {
                wx.showToast({
                    title: '您还没有登录',
                    image: '../images/fails.png',
                    duration: 2000
                })
            }
        }
        onShareAppMessage() {
        }
        onLoad(option) {
            if(option.num) {
                this.num = option.num
            }

            getExtJson.call(this)
            this.userseeds()
            this.$apply()
        }
        onShow() {
            this.statusArr = []
            if(this.num == 0) {
                this.myjilu()
            }
            if(this.num == 1) {
                this.userseeds()
            }
            if(this.num == 2) {
                this.myreturn()
            }
            wepy.request({
                url: `${this.api_host}/restapi/userinfo`,
                method: 'get',
                data: {
                    openid: wx.getStorageSync('openid')
                },
                success: (res) => {
                    if(res.data.data.items.length > 0) {
                        this.userInfo.nickName = res.data.data.items[0].nickname
                        this.userInfo.avatarUrl = res.data.data.items[0].touxiang
                    } else {
                        if(this.$parent.globalData.userInfo) {
                            this.userInfo.nickName = this.$parent.globalData.userInfo.nickName
                            this.userInfo.avatarUrl = this.$parent.globalData.userInfo.avatarUrl
                        } else {}
                    }
                    this.$apply()
                }
            })
//            wepy.request({
//                url: `${this.api_host}/restapi/userinfo`,
//                method: 'get',
//                data: {
//                    openid: wx.getStorageSync('openid')
//                },
//                success: (res) => {
//                    console.log(res)
//                    if(res.data.data.items.length > 0) {
//                        this.userInfo.nickName = res.data.data.items[0].nickname
//                        this.userInfo.avatarUrl = res.data.data.items[0].touxiang
//                    } else {
//                        if(this.$parent.globalData.userInfo) {
//                            this.userInfo = this.$parent.globalData.userInfo
//                            this.$apply()
//                        } else {
//                            this.$invoke('modal', 'show', {
//                                content: '您还没有授权登录',
//                                title: '警告',
//                                specialType: 'getUserInfo',
//                                specialText: '登录',
//                                showCancel: true,
//                                success: (res) => {
//                                    if(res.confirm) {
//                                        if(res.data.userInfo){
//                                            console.log(this)
//                                            this.$parent.getUserInfo( res => {
//                                                this.userInfo = res
//                                                this.$apply()
//                                            })
//                                        }
//                                    }
//                                }
//                            })
//                        }
//
//                    }
//
//                    this.$apply()
//                }
//            })
        }
    }
</script>
